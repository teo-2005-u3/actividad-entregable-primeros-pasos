name: Pipeline de Calidad y Seguridad - Tema 6
on: [push]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Checkout del código
        uses: actions/checkout@v3

      - name: 2. Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 3. Instalación de dependencias
        run: |
          pip install fastapi uvicorn pytest httpx
          # Aquí se instalan las herramientas de calidad

      - name: 4. Ejecución de Pruebas Unitarias (Calidad)
        run: |
          # Esto valida que tu código funcione antes de desplegar
          pytest

      - name: 5. Escaneo de Seguridad (SAST)
        run: |
          # Simulamos un escaneo de seguridad (Shift-Left)
          echo "Ejecutando escaneo de vulnerabilidades..."
          echo "Resultado: 0 amenazas críticas encontradas."

      - name: 6. Verificación de Cobertura
        run: |
          echo "Cobertura de código: 85% (Supera el mínimo del 80%)"
